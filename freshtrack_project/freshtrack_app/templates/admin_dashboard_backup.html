{% extends 'base.html' %}

{% block title %}Admin Dashboard - FreshTrack{% endblock %}

{% block content %}
<style>
    .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #10b981;
    }
    
    .admin-title {
        font-size: 32px;
        font-weight: 700;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-left: 4px solid #10b981;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    
    .stat-card.pending {
        border-left-color: #f59e0b;
    }
    
    .stat-card.approved {
        border-left-color: #10b981;
    }
    
    .stat-card.rejected {
        border-left-color: #ef4444;
    }
    
    .stat-card.expired {
        border-left-color: #6b7280;
    }
    
    .stat-value {
        font-size: 36px;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 8px;
    }
    
    .stat-label {
        font-size: 14px;
        color: #6b7280;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 40px 0 20px 0;
        padding-bottom: 15px;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .section-title {
        font-size: 24px;
        font-weight: 700;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .product-count {
        background: #10b981;
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
    }
    
    .products-table {
        width: 100%;
        background: white;
        border-radius: 12px;
        overflow-x: auto;
        overflow-y: auto;
        max-height: 600px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        margin-bottom: 30px;
    }
    
    .products-table::-webkit-scrollbar {
        height: 8px;
        width: 8px;
    }
    
    .products-table::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    .products-table::-webkit-scrollbar-thumb {
        background: #10b981;
        border-radius: 4px;
    }
    
    .products-table::-webkit-scrollbar-thumb:hover {
        background: #059669;
    }
    
    .products-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .products-table thead {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .products-table th {
        padding: 16px 12px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .products-table tbody tr {
        border-bottom: 1px solid #f3f4f6;
        transition: background-color 0.2s;
    }
    
    .products-table tbody tr:hover {
        background-color: #f9fafb;
    }
    
    .products-table tbody tr:last-child {
        border-bottom: none;
    }
    
    .products-table td {
        padding: 16px 12px;
        font-size: 14px;
        color: #374151;
        vertical-align: middle;
    }
    
    .product-name {
        font-weight: 600;
        color: #1f2937;
    }
    
    .seller-name {
        color: #6b7280;
        font-size: 13px;
    }
    
    .price-cell {
        font-weight: 600;
        color: #059669;
        font-size: 15px;
    }
    
    .status-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-badge.pending {
        background: #fef3c7;
        color: #92400e;
    }
    
    .status-badge.approved {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-badge.rejected {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .status-badge.expired {
        background: #f3f4f6;
        color: #4b5563;
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    
    .btn-approve {
        background: #10b981;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 0.2s, transform 0.1s;
        border: none;
        cursor: pointer;
    }
    
    .btn-approve:hover {
        background: #059669;
        transform: translateY(-1px);
    }
    
    .btn-reject {
        background: #ef4444;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 0.2s, transform 0.1s;
        border: none;
        cursor: pointer;
    }
    
    .btn-reject:hover {
        background: #dc2626;
        transform: translateY(-1px);
    }
    
    .btn-pending {
        background: #f59e0b;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 0.2s, transform 0.1s;
        border: none;
        cursor: pointer;
    }
    
    .btn-pending:hover {
        background: #d97706;
        transform: translateY(-1px);
    }
    
    .btn-hold {
        background: #f59e0b;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 0.2s, transform 0.1s;
        border: none;
        cursor: pointer;
    }
    
    .btn-hold:hover {
        background: #d97706;
        transform: translateY(-1px);
    }
    
    .no-products {
        text-align: center;
        padding: 60px 20px;
        color: #9ca3af;
    }
    
    .no-products-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }
    
    .no-products-text {
        font-size: 16px;
        color: #6b7280;
    }
    
    .date-time {
        font-size: 13px;
        color: #6b7280;
    }
    
    .quantity-cell {
        font-weight: 500;
    }
</style>

<div class="admin-header">
    <h1 class="admin-title">
        <span>‚öôÔ∏è</span>
        Admin Dashboard
    </h1>
</div>

<!-- Quick Navigation Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 40px;">
    <!-- Sales Analytics Card -->
    <a href="{% url 'admin_sales_analytics' %}" style="text-decoration: none;">
        <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;">
            <div style="font-size: 42px; margin-bottom: 10px;">üìä</div>
            <div style="font-size: 20px; font-weight: 700; margin-bottom: 5px;">Sales Analytics</div>
            <div style="font-size: 14px; opacity: 0.9;">View detailed sales reports</div>
        </div>
    </a>
    
    <!-- Products Card -->
    <a href="{% url 'admin_products' %}" style="text-decoration: none;">
        <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;">
            <div style="font-size: 42px; margin-bottom: 10px;">üì¶</div>
            <div style="font-size: 20px; font-weight: 700; margin-bottom: 5px;">All Products ({{ all_products.count }})</div>
            <div style="font-size: 14px; opacity: 0.9;">Manage product listings</div>
        </div>
    </a>
    
    <!-- Sellers Card -->
    <a href="{% url 'admin_sellers' %}" style="text-decoration: none;">
        <div style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;">
            <div style="font-size: 42px; margin-bottom: 10px;">üè™</div>
            <div style="font-size: 20px; font-weight: 700; margin-bottom: 5px;">Sellers ({{ sellers.count }})</div>
            <div style="font-size: 14px; opacity: 0.9;">Control seller accounts</div>
        </div>
    </a>
    
    <!-- Users Card -->
    <a href="{% url 'admin_users' %}" style="text-decoration: none;">
        <div style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;">
            <div style="font-size: 42px; margin-bottom: 10px;">üë•</div>
            <div style="font-size: 20px; font-weight: 700; margin-bottom: 5px;">All Users ({{ all_users.count }})</div>
            <div style="font-size: 14px; opacity: 0.9;">Manage user accounts</div>
        </div>
    </a>
</div>

<script>
// Add hover effects to all navigation cards
document.querySelectorAll('a[href*="admin_"] > div').forEach(card => {
    card.parentElement.addEventListener('mouseenter', function() {
        card.style.transform = 'translateY(-4px)';
        card.style.boxShadow = '0 8px 24px rgba(0,0,0,0.2)';
    });
    card.parentElement.addEventListener('mouseleave', function() {
        card.style.transform = 'translateY(0)';
        const shadow = card.style.background.includes('10b981') ? 'rgba(16, 185, 129, 0.3)' :
                        card.style.background.includes('8b5cf6') ? 'rgba(139, 92, 246, 0.3)' :
                        card.style.background.includes('6366f1') ? 'rgba(99, 102, 241, 0.3)' :
                        'rgba(236, 72, 153, 0.3)';
        card.style.boxShadow = `0 4px 12px ${shadow}`;
    });
});
</script>

<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card pending">
        <div class="stat-value">{{ pending_count }}</div>
        <div class="stat-label">‚è≥ Pending Review</div>
    </div>
    <div class="stat-card approved">
        <div class="stat-value">{{ approved_count }}</div>
        <div class="stat-label">‚úÖ Approved</div>
    </div>
    <div class="stat-card rejected">
        <div class="stat-value">{{ rejected_count }}</div>
        <div class="stat-label">‚ùå Rejected</div>
    </div>
    <div class="stat-card expired">
        <div class="stat-value">{{ expired_count }}</div>
        <div class="stat-label">‚åõ Expired</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ sellers.count }}</div>
        <div class="stat-label">üë• Total Sellers</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ pending_users.count }}</div>
        <div class="stat-label">üîÑ Pending Users</div>
    </div>
</div>

{% endblock %}
    <!-- Most Selling Products -->
    <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 25px; border-radius: 12px; border-left: 5px solid #10b981; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #10b981;">
            <span style="font-size: 32px;">üìä</span>
            <h2 style="font-size: 22px; font-weight: 700; color: #065f46; margin: 0;">Most Selling Products</h2>
        </div>
        
        {% if most_selling_products %}
        <div style="background: white; border-radius: 10px; overflow: hidden;">
            <table style="width: 100%;">
                <thead>
                    <tr style="background: #10b981; color: white;">
                        <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 700;">#</th>
                        <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 700;">Product Name</th>
                        <th style="padding: 12px; text-align: center; font-size: 13px; font-weight: 700;">Quantity Sold</th>
                        <th style="padding: 12px; text-align: center; font-size: 13px; font-weight: 700;">Orders</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in most_selling_products %}
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 12px; font-weight: 700; color: #10b981; font-size: 16px;">{{ forloop.counter }}</td>
                        <td style="padding: 12px; font-weight: 600; color: #1f2937;">{{ product.product_name }}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 700; color: #10b981; font-size: 18px;">{{ product.total_quantity }}</td>
                        <td style="padding: 12px; text-align: center; color: #6b7280; font-weight: 600;">{{ product.total_sales }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="background: white; padding: 30px; border-radius: 10px; text-align: center;">
            <p style="color: #6b7280; margin: 0;">No sales data available yet</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Highest Revenue Products -->
    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 25px; border-radius: 12px; border-left: 5px solid #f59e0b; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f59e0b;">
            <span style="font-size: 32px;">üí∞</span>
            <h2 style="font-size: 22px; font-weight: 700; color: #92400e; margin: 0;">Highest Revenue Products</h2>
        </div>
        
        {% if highest_revenue_products %}
        <div style="background: white; border-radius: 10px; overflow: hidden;">
            <table style="width: 100%;">
                <thead>
                    <tr style="background: #f59e0b; color: white;">
                        <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 700;">#</th>
                        <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 700;">Product Name</th>
                        <th style="padding: 12px; text-align: center; font-size: 13px; font-weight: 700;">Total Revenue</th>
                        <th style="padding: 12px; text-align: center; font-size: 13px; font-weight: 700;">Orders</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in highest_revenue_products %}
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 12px; font-weight: 700; color: #f59e0b; font-size: 16px;">{{ forloop.counter }}</td>
                        <td style="padding: 12px; font-weight: 600; color: #1f2937;">{{ product.product_name }}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 700; color: #f59e0b; font-size: 18px;">‡ß≥{{ product.total_revenue|floatformat:2 }}</td>
                        <td style="padding: 12px; text-align: center; color: #6b7280; font-weight: 600;">{{ product.total_sales }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="background: white; padding: 30px; border-radius: 10px; text-align: center;">
            <p style="color: #6b7280; margin: 0;">No revenue data available yet</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- PENDING EDIT REQUESTS SECTION -->
{% if pending_edit_requests %}
<div id="edit-requests" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 25px; border-radius: 12px; margin-bottom: 40px; border-left: 5px solid #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2); scroll-margin-top: 100px;">
    <div class="section-header" style="margin: 0; padding-bottom: 20px; border-bottom: 2px solid #3b82f6;">
        <h2 class="section-title" style="color: #1e40af;">
            <span>‚úèÔ∏è</span>
            PENDING EDIT REQUESTS - {{ pending_edit_requests.count }} Awaiting Approval
        </h2>
    </div>

    <div class="products-table">
        <table style="width: 100%; background: white; border-radius: 8px;">
            <thead>
                <tr style="background: #3b82f6; color: white;">
                    <th style="padding: 15px; text-align: left; font-weight: 700;">Product</th>
                    <th style="padding: 15px; text-align: left; font-weight: 700;">Seller</th>
                    <th style="padding: 15px; text-align: center; font-weight: 700;">Current Values</th>
                    <th style="padding: 15px; text-align: center; font-weight: 700;">Requested Changes</th>
                    <th style="padding: 15px; text-align: center; font-weight: 700;">Requested</th>
                    <th style="padding: 15px; text-align: center; font-weight: 700;">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for edit_req in pending_edit_requests %}
                <tr style="border-bottom: 1px solid #e5e7eb;">
                    <td style="padding: 15px; vertical-align: top;">
                        <div style="font-weight: 700; color: #1f2937;">{{ edit_req.product.name }}</div>
                        <div style="font-size: 12px; color: #6b7280;">ID: {{ edit_req.product.id }}</div>
                    </td>
                    <td style="padding: 15px; vertical-align: top;">
                        <div style="font-weight: 600;">{{ edit_req.seller.company_name }}</div>
                        <div style="font-size: 12px; color: #6b7280;">{{ edit_req.seller.user.username }}</div>
                    </td>
                    <td style="padding: 15px; text-align: center; vertical-align: top;">
                        <div style="background: #f3f4f6; padding: 10px; border-radius: 6px;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Price: <strong>‡ß≥{{ edit_req.original_price }}</strong></div>
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Discount: <strong>{{ edit_req.original_discount }}%</strong></div>
                            <div style="font-size: 12px; color: #6b7280;">Stock: <strong>{{ edit_req.original_quantity }}</strong></div>
                        </div>
                    </td>
                    <td style="padding: 15px; text-align: center; vertical-align: top;">
                        <div style="background: #dbeafe; padding: 10px; border-radius: 6px; border: 2px solid #3b82f6;">
                            {% if edit_req.new_price %}
                            <div style="font-size: 12px; color: #1e40af; margin-bottom: 5px; font-weight: 600;">Price: <strong>‡ß≥{{ edit_req.new_price }}</strong></div>
                            {% endif %}
                            {% if edit_req.new_discount is not None %}
                            <div style="font-size: 12px; color: #1e40af; margin-bottom: 5px; font-weight: 600;">Discount: <strong>{{ edit_req.new_discount }}%</strong></div>
                            {% endif %}
                            {% if edit_req.new_quantity %}
                            <div style="font-size: 12px; color: #1e40af; font-weight: 600;">Stock: <strong>{{ edit_req.new_quantity }}</strong></div>
                            {% endif %}
                        </div>
                    </td>
                    <td style="padding: 15px; text-align: center; vertical-align: top;">
                        <div style="font-size: 12px; color: #6b7280;">{{ edit_req.requested_at|date:"M d, Y" }}</div>
                        <div style="font-size: 12px; color: #6b7280;">{{ edit_req.requested_at|date:"H:i" }}</div>
                    </td>
                    <td style="padding: 15px; text-align: center; vertical-align: top;">
                        <div style="display: flex; gap: 8px; justify-content: center;">
                            <a href="{% url 'approve_edit_request' edit_req.id %}" style="background: #10b981; color: white; padding: 10px 18px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);">
                                ‚úÖ Approve
                            </a>
                            <a href="{% url 'reject_edit_request' edit_req.id %}" style="background: #ef4444; color: white; padding: 10px 18px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);">
                                ‚ùå Reject
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- PENDING PRODUCTS REVIEW SECTION - PRIORITY -->
{% if pending_count > 0 %}
<div id="pending-products" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 25px; border-radius: 12px; margin-bottom: 40px; border-left: 5px solid #f59e0b; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2); scroll-margin-top: 100px;">
    <div class="section-header" style="margin: 0; padding-bottom: 20px; border-bottom: 2px solid #f59e0b;">
        <h2 class="section-title" style="color: #b45309;">
            <span>‚è≥</span>
            PENDING PRODUCTS REVIEW - {{ pending_count }} Awaiting Approval
        </h2>
    </div>

    <div class="products-table">
        <table style="width: 100%; background: white; border-radius: 8px;">
            <thead>
                <tr style="background: #f59e0b; color: white;">
                    <th style="padding: 15px; text-align: left; font-weight: 700;">Product Details</th>
                    <th style="padding: 15px; text-align: left; font-weight: 700;">Seller Info</th>
                    <th style="padding: 15px; text-align: center; font-weight: 700;">Price / Qty</th>
                    <th style="padding: 15px; text-align: center; font-weight: 700;">Expiry Date</th>
                    <th style="padding: 15px; text-align: center; font-weight: 700;">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for product in all_products %}
                {% if product.status == 'pending' %}
                <tr style="border-bottom: 1px solid #e5e7eb; hover: background: #f9fafb;">
                    <td style="padding: 15px; vertical-align: top;">
                        <div style="font-weight: 700; color: #1f2937; margin-bottom: 5px;">{{ product.name }}</div>
                        <div style="font-size: 12px; color: #6b7280;">Added: {{ product.created_at|date:"M d, Y H:i" }}</div>
                    </td>
                    <td style="padding: 15px; vertical-align: top;">
                        <div style="font-weight: 600; color: #1f2937;">{{ product.seller.company_name }}</div>
                        <div style="font-size: 12px; color: #6b7280;">{{ product.seller.user.email }}</div>
                    </td>
                    <td style="padding: 15px; text-align: center; vertical-align: top;">
                        <div style="font-weight: 700; font-size: 16px; color: #10b981;">‡ß≥{{ product.price|floatformat:2 }}</div>
                        <div style="font-size: 12px; color: #6b7280;">{{ product.quantity }} units</div>
                    </td>
                    <td style="padding: 15px; text-align: center; vertical-align: top;">
                        <div style="font-weight: 600; color: #1f2937;">{{ product.expiry_datetime|date:"M d, Y" }}</div>
                        <div style="font-size: 12px; color: #6b7280;">
                            {% with hours=product.hours_remaining %}
                            {{ hours|floatformat:1 }}h remaining
                            {% endwith %}
                        </div>
                    </td>
                    <td style="padding: 15px; text-align: center; vertical-align: top;">
                        <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                            <a href="{% url 'approve_product' product.id %}" style="background: #10b981; color: white; padding: 10px 18px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; border: none; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);">
                                ‚úÖ Approve
                            </a>
                            <a href="{% url 'reject_product' product.id %}" style="background: #ef4444; color: white; padding: 10px 18px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; border: none; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);">
                                ‚ùå Reject
                            </a>
                        </div>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div style="background: #d1fae5; padding: 20px; border-radius: 12px; margin-bottom: 40px; border-left: 5px solid #10b981; text-align: center;">
    <div style="font-size: 28px; margin-bottom: 10px;">‚úÖ</div>
    <div style="font-weight: 700; color: #065f46; font-size: 16px;">All Products Reviewed!</div>
    <div style="color: #047857; font-size: 14px; margin-top: 5px;">No pending products awaiting approval</div>
</div>
{% endif %}

<!-- Product Moderation Table -->
<div id="product-moderation" style="scroll-margin-top: 100px;">
<div class="section-header">
    <h2 class="section-title">
        <span>üì¶</span>
        Product Moderation
    </h2>
    <span class="product-count">{{ all_products.count }} Total Products</span>
</div>

<div class="products-table">
    {% if all_products %}
    <table>
        <thead>
            <tr>
                <th>Product Name</th>
                <th>Seller/Company</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Manufacturing Date</th>
                <th>Expiry Date</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in all_products %}
            <tr>
                <td>
                    <div class="product-name">{{ product.name }}</div>
                </td>
                <td>
                    <div class="seller-name">{{ product.seller.company_name }}</div>
                </td>
                <td>
                    <div class="price-cell">‡ß≥{{ product.price|floatformat:2 }}</div>
                </td>
                <td>
                    <div class="quantity-cell">{{ product.quantity }} units</div>
                </td>
                <td>
                    <div class="date-time">{{ product.manufacturing_date|date:"M d, Y" }}</div>
                    <div class="date-time">{{ product.manufacturing_date|date:"H:i" }}</div>
                </td>
                <td>
                    <div class="date-time">{{ product.expiry_datetime|date:"M d, Y" }}</div>
                    <div class="date-time">{{ product.expiry_datetime|date:"H:i" }}</div>
                </td>
                <td>
                    <span class="status-badge {{ product.status }}">
                        {% if product.status == 'pending' %}
                        ‚è≥ Pending
                        {% elif product.status == 'approved' %}
                        ‚úÖ Approved
                        {% elif product.status == 'rejected' %}
                        ‚ùå Rejected
                        {% elif product.status == 'expired' %}
                        ‚åõ Expired
                        {% endif %}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        {% if product.status != 'approved' %}
                        <a href="{% url 'approve_product' product.id %}" class="btn-approve">
                            ‚úÖ Approve
                        </a>
                        {% endif %}
                        
                        {% if product.status != 'rejected' %}
                        <a href="{% url 'reject_product' product.id %}" class="btn-reject">
                            ‚ùå Reject
                        </a>
                        {% endif %}
                        
                        {% if product.status != 'pending' and product.status != 'expired' %}
                        <a href="{% url 'pending_product' product.id %}" class="btn-pending">
                            ‚è≥ Move to Pending
                        </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="no-products">
        <div class="no-products-icon">üì¶</div>
        <div class="no-products-text">No products found.</div>
    </div>
    {% endif %}
</div>
</div>

<!-- SELLER MANAGEMENT SECTION -->
<div id="seller-management" style="scroll-margin-top: 100px;">
<div class="section-header" style="margin-top: 60px;">
    <h2 class="section-title">
        <span>üè™</span>
        Seller Management & Control
    </h2>
    <span class="product-count">{{ sellers.count }} Sellers</span>
</div>

<div class="products-table">
    <table>
        <thead>
            <tr style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">
                <th>Seller Info</th>
                <th>Company</th>
                <th>Products</th>
                <th>Status</th>
                <th>Registered</th>
                <th>Admin Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for seller in sellers %}
            <tr>
                <td>
                    <div class="product-name">{{ seller.user.username }}</div>
                    <div style="font-size: 12px; color: #6b7280;">{{ seller.user.email }}</div>
                </td>
                <td>
                    <div style="font-weight: 600;">{{ seller.company_name }}</div>
                </td>
                <td>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span style="background: #10b981; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">‚úÖ {{ seller.approved_products }}</span>
                        <span style="background: #f59e0b; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">‚è≥ {{ seller.pending_products }}</span>
                        <span style="background: #ef4444; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">‚ùå {{ seller.rejected_products }}</span>
                    </div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">Total: {{ seller.product_count }}</div>
                </td>
                <td>
                    <span class="status-badge {{ seller.user_role.is_approved }}">
                        {% if seller.user_role.is_approved == 'pending' %}
                        ‚è≥ Pending
                        {% elif seller.user_role.is_approved == 'approved' %}
                        ‚úÖ Approved
                        {% elif seller.user_role.is_approved == 'rejected' %}
                        ‚ùå Rejected
                        {% endif %}
                    </span>
                </td>
                <td>
                    <div class="date-time">{{ seller.user.date_joined|date:"M d, Y" }}</div>
                    <div class="date-time">{{ seller.user.date_joined|date:"H:i" }}</div>
                </td>
                <td>
                    <div class="action-buttons">
                        {% if seller.user_role.is_approved != 'approved' %}
                        <a href="{% url 'approve_user' seller.user_role.id %}" class="btn-approve" title="Approve seller & restore products">
                            ‚úÖ Approve
                        </a>
                        {% endif %}
                        
                        {% if seller.user_role.is_approved != 'rejected' %}
                        <a href="{% url 'reject_user' seller.user_role.id %}" class="btn-reject" title="Reject seller & hide all products">
                            ‚ùå Reject
                        </a>
                        {% endif %}
                        
                        {% if seller.user_role.is_approved != 'pending' %}
                        <a href="{% url 'hold_user' seller.user_role.id %}" class="btn-hold" title="Put seller on hold & move products to pending">
                            ‚è∏Ô∏è Hold
                        </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</div>

<!-- ALL USERS MANAGEMENT SECTION -->
<div id="user-management" style="scroll-margin-top: 100px;">
<div class="section-header" style="margin-top: 60px;">
    <h2 class="section-title">
        <span>üë•</span>
        All Users Management
    </h2>
    <span class="product-count">{{ all_users.count }} Total Users</span>
</div>

<div class="products-table">
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Registered</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user_role in all_users %}
            <tr>
                <td>
                    <div class="product-name">{{ user_role.user.username }}</div>
                </td>
                <td>{{ user_role.user.email }}</td>
                <td>
                    <span style="background: {% if user_role.role == 'seller' %}#8b5cf6{% elif user_role.role == 'buyer' %}#3b82f6{% else %}#10b981{% endif %}; color: white; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600;">
                        {{ user_role.role|upper }}
                    </span>
                </td>
                <td>
                    <span class="status-badge {{ user_role.is_approved }}">
                        {% if user_role.is_approved == 'pending' %}
                        ‚è≥ Pending
                        {% elif user_role.is_approved == 'approved' %}
                        ‚úÖ Approved
                        {% elif user_role.is_approved == 'rejected' %}
                        ‚ùå Rejected
                        {% endif %}
                    </span>
                </td>
                <td>
                    <div class="date-time">{{ user_role.user.date_joined|date:"M d, Y H:i" }}</div>
                </td>
                <td>
                    <div class="action-buttons">
                        {% if user_role.is_approved != 'approved' %}
                        <a href="{% url 'approve_user' user_role.id %}" class="btn-approve">
                            ‚úÖ Approve
                        </a>
                        {% endif %}
                        
                        {% if user_role.is_approved != 'rejected' %}
                        <a href="{% url 'reject_user' user_role.id %}" class="btn-reject">
                            ‚ùå Reject
                        </a>
                        {% endif %}
                        
                        {% if user_role.is_approved != 'pending' %}
                        <a href="{% url 'hold_user' user_role.id %}" class="btn-hold">
                            ‚è∏Ô∏è Hold
                        </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}